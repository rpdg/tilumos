{"version":3,"sources":["/page/main.ts"],"names":[],"mappings":"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","file":"main.js","sourcesContent":["import opg from 'ts/opg.ts';\r\nimport {store, Cache} from 'ts/util/store';\r\nimport cfg from 'ts/app.cfg.ts';\r\nimport PopUp from 'ts/ui/Popup';\r\n\r\nopg.api({\r\n\tbackendVersion: 'base/version',\r\n});\r\n\r\n\r\n//opg.api.menu(function (json) {\r\n\r\nlet permissions = [{\r\n\t'id': 2,\r\n\t'parentId': 1,\r\n\t'name': '内容生产',\r\n\t'children': [{\r\n\t\t'id': 200,\r\n\t\t'parentId': 2,\r\n\t\t'name': '发起生产',\r\n\t\t'code': '200',\r\n\t\t'url': __uri('clickNoteList.aspx'),\r\n\t}, {\r\n\t\t'id': 201,\r\n\t\t'parentId': 2,\r\n\t\t'name': '内容采集',\r\n\t\t'code': '201',\r\n\t\t'url': '/page/collection/acquisition/index.html',\r\n\t}],\r\n\t'code': '2',\r\n}];\r\n\r\n\r\nlet menu = {}, curMainMenuId;\r\n\r\nfor (let i = 0, l = permissions.length; i < l; i++) {\r\n\tlet mn = permissions[i];\r\n\tmenu['#' + mn.id] = mn;\r\n}\r\n\r\nlet mainMenu = $('#mainMenu'),\r\n\tsubMenu = $('#subMenu'),\r\n\tdivTd = $('#td'),\r\n\tmainFrame: JQuery = $('#mainFrame'),\r\n\tmainFrameWindow: Window = (mainFrame[0] as HTMLIFrameElement).contentWindow as Window;\r\n\r\n/*if (permissions.length > 6) {\r\n mainMenu.addClass('small-menu');\r\n }*/\r\n\r\n$('#divPn1').click(function () {\r\n\tlet that = $(this);\r\n\tif (that.hasClass('ellipse')) {\r\n\t\tthat.removeClass('ellipse');\r\n\t\tsubMenu.css('width', 180);\r\n\t\tdivTd.css('left', 180);\r\n\t}\r\n\telse {\r\n\t\tthat.addClass('ellipse');\r\n\t\tsubMenu.css('width', 0);\r\n\t\tdivTd.css('left', 0);\r\n\t}\r\n});\r\n\r\nlet mainMenuSelector = 'a:eq(0)', subMenuSelector = 'a:eq(0)';\r\nif (location.hash.length > 1) {\r\n\tlet ph = location.hash.split('/');\r\n\tmainMenuSelector = '#\\\\' + ph[0];\r\n\tif (ph[1]) {\r\n\t\tsubMenuSelector = '#\\\\/' + ph[1];\r\n\t}\r\n}\r\n\r\nsubMenu.on('click', 'a', function () {\r\n\tlet sm = $(this);\r\n\tsm.addClass('cur').siblings('.cur').removeClass('cur');\r\n\tCache.empty();\r\n\t//mainFrame.attr('src', sm.attr('href') as string);\r\n\tmainFrameWindow.location.replace(sm.attr('href'));\r\n\r\n\tlocation.hash = curMainMenuId + sm[0].id;\r\n\r\n\r\n\tif (sm.hasClass('hasChildren')) {\r\n\t\tconsole.warn(sm.text() + ' has permission control!');\r\n\t}\r\n\treturn false;\r\n});\r\n\r\nmainMenu.on('click', 'a', function () {\r\n\tlet cur = $(this), mnId = cur.attr('href');\r\n\tcurMainMenuId = mnId;\r\n\tcur.addClass('cur').siblings('.cur').removeClass('cur');\r\n\r\n\tsubMenu.bindList({\r\n\t\ttemplate: '<a id=\"/${id}\" href=\"${url}\" target=\"mainFrame\" class=\"${id:=g}\">${name}</a>',\r\n\t\tlist: menu[mnId].children,\r\n\t\titemRender: {\r\n\t\t\tg: (v, i, row) => {\r\n\t\t\t\tif (row.children && row.children.length) {\r\n\t\t\t\t\treturn 'hasChildren';\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t}).find(subMenuSelector).click();\r\n\r\n\tif (subMenuSelector != 'a:eq(0)')\r\n\t\tsubMenuSelector = 'a:eq(0)';\r\n\r\n});\r\n\r\n\r\nmainMenu.bindList({\r\n\ttemplate: '<a id=\"#${id}\" href=\"#${id}\">${name}</a>',\r\n\tlist: permissions,\r\n}).find(mainMenuSelector).click();\r\n\r\n\r\nlet wViewport = window.document.documentElement.clientWidth, wMenu = mainMenu.outerWidth();\r\nconsole.log(wViewport - wMenu);\r\n\r\nif (wViewport - wMenu < 0) {\r\n\tmainMenu.addClass('nano-menu');\r\n}\r\nif (wViewport - wMenu < 150) {\r\n\tmainMenu.addClass('mini-menu');\r\n}\r\nelse if (wViewport - wMenu < 300) {\r\n\tmainMenu.addClass('small-menu');\r\n}\r\n\r\n\r\n$('#liAbout').click(function () {\r\n\r\n\tlet html = `<div style=\"height: 80px; font-size: 12px; color: #555; padding-top: 12px; text-align: center;\">\r\n\t\t\t\t\t<h2 style=\"font-size: 32px; margin-bottom: 3px;\">CMS v6</h2>\r\n\t\t\t\t\t<span style=\"font-size: 12px;\"><span style=\"display: inline-block;width: 80px;font-size: 12px;\">front-end：</span>${cfg.version}</span><br>\r\n\t\t\t\t</div>`;\r\n\r\n\topg.alert(html, $.noop, {\r\n\t\ttitle: '关于 IMSP',\r\n\t\twidth: 500,\r\n\t});\r\n\r\n});\r\n\r\n\r\n$('#liLogOff').click(() => {\r\n\tstore.clear();\r\n\twindow.location.href = cfg.loginPage;\r\n});\r\n\r\n\r\nhistory.pushState(null, null, document.URL);\r\nwindow.addEventListener('popstate', function () {\r\n\t//debugger;\r\n\thistory.pushState(null, null, document.URL);\r\n\tPopUp.closeLast();\r\n});\r\n\r\n\r\n$('#liFullScreen').click(evt => {\r\n\t// Test for each of the supported versions of full screen APIs and call\r\n\t// either requestFullscreen or cancelFullScreen (or exitFullScreen)\r\n\t//  Structure:\r\n\t//  Does the incoming target support requestFullscreen (or prefaced version)\r\n\t//  if (there is a fullscreen element)\r\n\t//      then cancel or exit\r\n\t//  else request full screen mode\r\n\r\n\tlet divObj = evt.target as Node;  //  get the target element\r\n\r\n\tif (divObj.requestFullscreen)\r\n\t\tif (document.fullScreenElement) {\r\n\t\t\tdocument.cancelFullScreen();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.requestFullscreen();\r\n\t\t}\r\n\telse if (divObj.webkitRequestFullscreen)\r\n\t\tif (document.webkitFullscreenElement) {\r\n\t\t\tdocument.webkitCancelFullScreen();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.webkitRequestFullscreen();\r\n\t\t}\r\n\telse if (divObj.msRequestFullscreen)\r\n\t\tif (document.msFullscreenElement) {\r\n\t\t\tdocument.msExitFullscreen();\r\n\t\t} else {\r\n\t\t\tdocument.body.msRequestFullscreen();\r\n\t\t}\r\n\telse if (divObj.mozRequestFullScreen)\r\n\t\tif (document.mozFullScreenElement) {\r\n\t\t\tdocument.mozCancelFullScreen();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.mozRequestFullScreen();\r\n\t\t}\r\n\t//  stop bubbling so we don't get bounce back\r\n\tevt.stopPropagation();\r\n\r\n});"]}