{"version":3,"sources":["/ts/ui/DisplayOject.ts"],"names":[],"mappings":"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","file":"DisplayOject.js","sourcesContent":["import {AjaxMessage} from '../util/api'\r\n\r\n\r\ninterface UiObject {\r\n\tguid: number,\r\n\tjq: JQuery,\r\n\tcreate: Function,\r\n\t_created: boolean ,\r\n\tinit: Function,\r\n}\r\n\r\nconst blankArray: JQuery = $({});\r\n\r\nexport abstract class DisplayObject implements UiObject {\r\n\r\n\tpublic guid: number;\r\n\tpublic jq: JQuery;\r\n\r\n\tpublic onCreate?: Function;\r\n\r\n\tprotected _created: boolean = false;\r\n\tprotected _createdPromise: JQueryDeferred ;\r\n\r\n\tconstructor(jq: JQuery, cfg: any) {\r\n\r\n\t\tthis.guid = DisplayObject.guid();\r\n\t\tthis.jq = jq;\r\n\r\n\t\tthis.onCreate = cfg.onCreate;\r\n\r\n\t\tthis.init(jq, cfg);\r\n\r\n\t\tthis.create(jq, cfg);\r\n\t}\r\n\r\n\tinit(jq: JQuery, cfg: any) {\r\n\r\n\t}\r\n\r\n\tcreate(jq: JQuery, cfg: any): DisplayObject {\r\n\t\treturn this;\r\n\t}\r\n\r\n\tcreatedHandler(data?: any) {\r\n\t\tthis._created = true;\r\n\r\n\t\tif(this._createdPromise){\r\n\t\t\tthis._createdPromise.resolve();\r\n\t\t}\r\n\r\n\t\tif (this.onCreate) this.onCreate(data);\r\n\t}\r\n\r\n\tstatic guid: Function = (() => {\r\n\t\tlet seed = 0;\r\n\r\n\t\treturn (): number=> {\r\n\t\t\treturn ++seed;\r\n\t\t}\r\n\t})();\r\n\r\n\tget createdPromise():JQueryDeferred {\r\n\t\tif(!this._createdPromise)\r\n\t\t\tthis._createdPromise = $.Deferred();\r\n\r\n\t\tif(this._created)\r\n\t\t\tthis._createdPromise.resolve();\r\n\r\n\t\treturn this._createdPromise;\r\n\t}\r\n}\r\n\r\n\r\ninterface IListBase {\r\n\tselectedIndex: number ;\r\n\tdata : any;\r\n}\r\n\r\nexport abstract class AjaxDisplayObject extends DisplayObject implements IListBase {\r\n\r\n\tprotected _items?: JQuery;\r\n\tprotected _data?: any;\r\n\tprotected _json?: any;\r\n\tprotected _api?: Function;\r\n\tprotected _param?: any;\r\n\r\n\tprotected _lazy: boolean = false;\r\n\r\n\tprotected _bindOption?: BindOption;\r\n\tprotected _defBindOpt: BindOption = {};\r\n\r\n\tprotected _prevIndex: number|number[];\r\n\tprotected _selectedIndex: number|number[];\r\n\tprotected _initSelectedIndex: number|number[];\r\n\r\n\tpublic onUpdate?: Function;\r\n\tpublic onAjaxEnd?: Function;\r\n\tpublic onBind?: Function;\r\n\tpublic onSelect?: Function;\r\n\r\n\tpublic container: JQuery;\r\n\tpublic arrSrc: string;\r\n\r\n\tconstructor(jq: JQuery, cfg: any) {\r\n\r\n\t\tsuper(jq, cfg);\r\n\r\n\t}\r\n\r\n\tinit(jq: JQuery, cfg: any) {\r\n\t\tthis._api = cfg.api;\r\n\t\tthis._bindOption = $.extend(this._defBindOpt, cfg.bindOptions);\r\n\t\tthis._lazy = !!cfg.lazy;\r\n\t\tthis._param = cfg.param;\r\n\t\tthis._items = blankArray;\r\n\r\n\t\tthis._prevIndex = -1;\r\n\t\tthis._selectedIndex = -1;\r\n\t\tthis._initSelectedIndex = -1;\r\n\r\n\t\tthis.arrSrc = cfg.arrSrc || 'results';\r\n\t\tthis.container = this.jq;\r\n\r\n\t\tthis.onUpdate = cfg.onUpdate;\r\n\t\tthis.onAjaxEnd = cfg.onAjaxEnd;\r\n\t\tthis.onSelect = cfg.onSelect;\r\n\t\tthis.onBind = cfg.onBind;\r\n\t}\r\n\r\n\tcreate(jq: JQuery, cfg: any) {\r\n\t\tif (!this._lazy) {\r\n\r\n\t\t\tif (cfg.data) {\r\n\t\t\t\tthis.bindData(cfg.data);\r\n\t\t\t}\r\n\t\t\telse if (this._api) {\r\n\t\t\t\tthis.ajax(this._param);\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\telse{\r\n\t\t\tthis.bindData([]);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tselectHandler(evt: Event) {\r\n\t\tif (typeof this.onSelect === 'function') this.onSelect.call(this , evt);\r\n\t}\r\n\r\n\tpublic set selectedIndex(i: number|number[]) {\r\n\t\tthis._prevIndex = this._selectedIndex;\r\n\t\tthis._selectedIndex = i;\r\n\r\n\t\tlet evt: Event = {target: this._items[i]} as Event;\r\n\t\tthis.selectHandler(evt);\r\n\t}\r\n\r\n\tpublic get selectedIndex(): number|number[] {\r\n\t\treturn this._selectedIndex;\r\n\r\n\t}\r\n\r\n\tpublic get selectedData(): any {\r\n\t\treturn this._data[this._selectedIndex];\r\n\t}\r\n\r\n\tpublic get selectedItem(): any {\r\n\t\treturn this._items[this._selectedIndex];\r\n\t}\r\n\r\n\tpublic set data(data: any) {\r\n\t\tthis._data = data;\r\n\r\n\t\tif (this._created) {\r\n\t\t\tthis.updateHandler(data);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.createdHandler(data);\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get data(): any {\r\n\t\treturn this._data;\r\n\t}\r\n\r\n\r\n\tupdate(param?: any) {\r\n\t\tif (this._api) {\r\n\t\t\tif (this._param) $.extend(this._param, param);\r\n\t\t\telse this._param = param;\r\n\r\n\t\t\tthis.ajax(this._param);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlet data = param || this._data;\r\n\t\t\tthis.bindData(data);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\tupdateHandler(data: any) {\r\n\t\tif (this.onUpdate) this.onUpdate(data);\r\n\t}\r\n\r\n\tajax(param ?: any) {\r\n\r\n\t\tlet that = this;\r\n\r\n\t\tthis._api(param, (json) => {\r\n\r\n\t\t\tthat._json = json;\r\n\r\n\t\t\tthat.ajaxEndHandler(json);\r\n\r\n\t\t\tthat.bindData(json);\r\n\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tajaxEndHandler(json: any) {\r\n\t\tif (this.onAjaxEnd) this.onAjaxEnd(json);\r\n\t}\r\n\r\n\tbindData(data: AjaxMessage|Array) {\r\n\r\n\t\t//this._json = data;\r\n\r\n\t\tlet list: Array;\r\n\r\n\t\tif ($.isArray(data)) {\r\n\t\t\tlist = data as Array;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tlist = data[this.arrSrc];\r\n\t\t}\r\n\r\n\t\tthis._bindOption.list = list;\r\n\r\n\t\t// 如果有过滤器，则需要\r\n\t\t// 将过滤后的array保存下，待稍后作为 this.data\r\n\t\tif (this._bindOption.itemFilter) this._bindOption.storeData = true;\r\n\r\n\t\t// bind data\r\n\t\tthis.container.bindList(this._bindOption);\r\n\r\n\r\n\t\t//this.data 是过滤后的数组\r\n\t\tif (this._bindOption.itemFilter) {\r\n\t\t\tthis.data = this.container.data('bound-array');\r\n\t\t\tthis.container.removeData('bound-array');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.data = list;\r\n\t\t}\r\n\r\n\r\n\t\tthis.bindHandler(data);\r\n\r\n\t\treturn this;\r\n\t}\r\n\r\n\tbindHandler(json: any) {\r\n\t\tif (this.onBind) this.onBind(json);\r\n\t}\r\n\r\n}\r\n\r\n"]}