!function(e,t){"use strict";if("function"==typeof define&&define.amd&&define.amd.jQuery)define(["jquery"],function(n){return t(n,e)});else{if("object"!=typeof exports)return t(e.jQuery||e.$,e);module.exports=t}}(this,function(e,t){"use strict";function n(n){void 0===t.DOMParser&&t.ActiveXObject&&(t.DOMParser=function(){},DOMParser.prototype.parseFromString=function(e){var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t});try{var r=(new DOMParser).parseFromString(n,"text/xml");if(!e.isXMLDoc(r))throw new Error("Unable to parse XML");var o=e("parsererror",r);if(1===o.length)throw new Error("Error: "+e(r).text());return r}catch(s){var a=void 0===s.name?s:s.name+": "+s.message;return void e(document).trigger("xmlParseError",[a])}}function r(t,n){O.debug(t,["Checking mock data against request data",t,n]);var s=!0;if(e.isFunction(t))return!!t(n);if("string"==typeof n){if(e.isFunction(t.test))return t.test(n);if("object"!=typeof t)return t===n;n=o(n)}return e.each(t,function(o){return void 0===n[o]?s=!1:void("object"==typeof n[o]&&null!==n[o]?(s&&e.isArray(n[o])&&(s=e.isArray(t[o])&&n[o].length===t[o].length),s=s&&r(t[o],n[o])):s=t[o]&&e.isFunction(t[o].test)?s&&t[o].test(n[o]):s&&t[o]===n[o])}),s}function o(e){var t,n,r,o,s={},a=String(e).split(/&/);for(t=0,n=a.length;n>t;++t){r=a[t];try{r=decodeURIComponent(r.replace(/\+/g," ")),r=r.split(/=/)}catch(i){continue}s[r[0]]?(s[r[0]].splice||(o=s[r[0]],s[r[0]]=[],s[r[0]].push(o)),s[r[0]].push(r[1])):s[r[0]]=r[1]}return O.debug(null,["Getting query params from string",e,s]),s}function s(t,n){return t[n]===e.mockjaxSettings[n]}function a(t,n){if(e.isFunction(t))return t(n);if(e.isFunction(t.url.test)){var o=t.namespace||e.mockjaxSettings.namespace;if(o)var s=n.url.replace(o,"");if(!t.url.test(s))return null}else{var a=t.namespace||e.mockjaxSettings.namespace;if(a){t.url=t.url.replace(a,"");var i=[a,t.url].join("/"),u="";/^http:|https:/gi.test(i)&&(u=i.replace(/(^http:\/\/|https:\/\/).*(\w*)/gi,"$1"),i=i.substr(u.length)),i=i.replace(/(\/+)/g,"/"),t.url=u+i}{var l=t.url.indexOf("*"),c=n.url.split("?"),p=c[0];c[1]}if(t.url!==p&&-1===l||!new RegExp(t.url.replace(/[-[\]{}()+?.,\\^$|#\s]/g,"\\$&").replace(/\*/g,".+")).test(p))return null}if(t.requestHeaders){if(void 0===n.headers)return null;var f=!1;if(e.each(t.requestHeaders,function(e,t){var r=n.headers[e];return r!==t?(f=!0,!1):void 0}),f)return null}return!t.data||n.data&&r(t.data,n.data)?t&&t.type&&t.type.toLowerCase()!==n.type.toLowerCase()?null:t:null}function i(e){return"number"==typeof e&&e>=0}function u(t){if(e.isArray(t)&&2===t.length){var n=t[0],r=t[1];if(i(n)&&i(r))return Math.floor(Math.random()*(r-n))+n}else if(i(t))return t;return w}function l(t,r,o){O.debug(t,["Sending fake XHR request",t,r,o]);var a=function(s){return function(){return function(){this.status=t.status,this.statusText=t.statusText,this.readyState=1;var a=function(){this.readyState=4;var o;"json"===r.dataType&&"object"==typeof t.responseText?this.responseText=JSON.stringify(t.responseText):"xml"===r.dataType?"string"==typeof t.responseXML?(this.responseXML=n(t.responseXML),this.responseText=t.responseXML):this.responseXML=t.responseXML:"object"==typeof t.responseText&&null!==t.responseText?(t.contentType="application/json",this.responseText=JSON.stringify(t.responseText)):this.responseText=t.responseText,("number"==typeof t.status||"string"==typeof t.status)&&(this.status=t.status),"string"==typeof t.statusText&&(this.statusText=t.statusText),o=this.onload||this.onreadystatechange,e.isFunction(o)?(t.isTimeout&&(this.status=-1),o.call(this,t.isTimeout?"timeout":void 0)):t.isTimeout&&(this.status=-1)};if(e.isFunction(t.response)){if(2===t.response.length)return void t.response(o,function(){a.call(s)});t.response(o)}a.call(s)}.apply(s)}}(this);t.proxy?(O.info(t,["Retrieving proxy file: "+t.proxy,t]),v({global:!1,url:t.proxy,type:t.proxyType,data:t.data,async:r.async,dataType:"script"===r.dataType?"text/plain":r.dataType,complete:function(e){t.responseXML=t.responseText=e.responseText,s(t,"status")&&(t.status=e.status),s(t,"statusText")&&(t.statusText=e.statusText),r.async===!1?a():this.responseTimer=setTimeout(a,u(t.responseTime))}})):r.async===!1?a():this.responseTimer=setTimeout(a,u(t.responseTime))}function c(t,n,r,o){return O.debug(t,["Creating new mock XHR object",t,n,r,o]),t=e.extend(!0,{},e.mockjaxSettings,t),"undefined"==typeof t.headers&&(t.headers={}),"undefined"==typeof n.headers&&(n.headers={}),t.contentType&&(t.headers["content-type"]=t.contentType),{status:t.status,statusText:t.statusText,readyState:1,open:function(){},send:function(){o.fired=!0,l.call(this,t,n,r)},abort:function(){clearTimeout(this.responseTimer)},setRequestHeader:function(e,t){n.headers[e]=t},getResponseHeader:function(e){return t.headers&&t.headers[e]?t.headers[e]:"last-modified"===e.toLowerCase()?t.lastModified||(new Date).toString():"etag"===e.toLowerCase()?t.etag||"":"content-type"===e.toLowerCase()?t.contentType||"text/plain":void 0},getAllResponseHeaders:function(){var n="";return t.contentType&&(t.headers["Content-Type"]=t.contentType),e.each(t.headers,function(e,t){n+=e+": "+t+"\n"}),n}}}function p(e,t,n){if(f(e),e.dataType="json",e.data&&C.test(e.data)||C.test(e.url)){x(e,t,n);var r=/^(\w+:)?\/\/([^\/?#]+)/,o=r.exec(e.url),s=o&&(o[1]&&o[1]!==location.protocol||o[2]!==location.host);if(e.dataType="script","GET"===e.type.toUpperCase()&&s){var a=g(e,t,n);return a?a:!0}}return null}function f(e){"GET"===e.type.toUpperCase()?C.test(e.url)||(e.url+=(/\?/.test(e.url)?"&":"?")+(e.jsonp||"callback")+"=?"):e.data&&C.test(e.data)||(e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?")}function g(t,n,r){O.debug(n,["Performing JSONP request",n,t,r]);var o=r&&r.context||t,s=e.Deferred?new e.Deferred:null;if(n.response&&e.isFunction(n.response))n.response(r);else if("object"==typeof n.responseText)e.globalEval("("+JSON.stringify(n.responseText)+")");else{if(n.proxy)return O.info(n,["Performing JSONP proxy request: "+n.proxy,n]),v({global:!1,url:n.proxy,type:n.proxyType,data:n.data,dataType:"script"===t.dataType?"text/plain":t.dataType,complete:function(r){e.globalEval("("+r.responseText+")"),d(t,n,o,s)}}),s;e.globalEval("("+("string"==typeof n.responseText?'"'+n.responseText+'"':n.responseText)+")")}return d(t,n,o,s),s}function d(t,n,r,o){var s;setTimeout(function(){if(m(t,r,n),y(t,r),o){try{s=e.parseJSON(n.responseText)}catch(a){}o.resolveWith(r,[s||n.responseText]),O.log(n,["JSONP mock call complete",n,o])}},u(n.responseTime))}function x(e,n,r){var o=r&&r.context||e,s="string"==typeof e.jsonpCallback&&e.jsonpCallback||"jsonp"+M++;e.data&&(e.data=(e.data+"").replace(C,"="+s+"$1")),e.url=e.url.replace(C,"="+s+"$1"),t[s]=t[s]||function(){m(e,o,n),y(e,o),t[s]=void 0;try{delete t[s]}catch(r){}},e.jsonpCallback=s}function m(t,n,r){t.success&&t.success.call(n,r.responseText||"","success",{}),t.global&&(t.context?e(t.context):e.event).trigger("ajaxSuccess",[{},t])}function y(t,n){t.complete&&t.complete.call(n,{statusText:"success",status:200},"success"),t.global&&(t.context?e(t.context):e.event).trigger("ajaxComplete",[{},t]),t.global&&!--e.active&&e.event.trigger("ajaxStop")}function h(t,n){var r,o,s,i;O.debug(null,["Ajax call intercepted",t,n]),"object"==typeof t?(n=t,t=void 0):(n=n||{},n.url=t||n.url),o=e.ajaxSetup({},n),o.type=o.method=o.method||o.type,i=function(t,r){var o=n[t.toLowerCase()];return function(){e.isFunction(o)&&o.apply(this,[].slice.call(arguments)),r["onAfter"+t]()}};for(var u=0;u<k.length;u++)if(k[u]){if(s=a(k[u],o))return e.mockjaxSettings.retainAjaxCalls&&b.push(o),O.info(s,["MOCK "+o.type.toUpperCase()+": "+o.url,e.ajaxSetup({},o)]),o.dataType&&"JSONP"===o.dataType.toUpperCase()&&(r=p(o,s,n))?r:(n.crossDomain=!1,s.cache=o.cache,s.timeout=o.timeout,s.global=o.global,s.isTimeout&&(s.responseTime>1?n.timeout=s.responseTime-1:(s.responseTime=2,n.timeout=1)),e.isFunction(s.onAfterSuccess)&&(n.success=i("Success",s)),e.isFunction(s.onAfterError)&&(n.error=i("Error",s)),e.isFunction(s.onAfterComplete)&&(n.complete=i("Complete",s)),T(s,n),function(t,n,o,s){r=v.call(e,e.extend(!0,{},o,{xhr:function(){return c(t,n,o,s)}}))}(s,o,n,k[u]),r);O.debug(k[u],["Mock does not match request",t,o])}if(O.log(null,["No mock matched to request",t,n]),e.mockjaxSettings.retainAjaxCalls&&S.push(n),e.mockjaxSettings.throwUnmocked===!0)throw new Error("AJAX not mocked: "+n.url);return v.apply(e,[n])}function T(e,t){if(e.url instanceof RegExp&&e.hasOwnProperty("urlParams")){var n=e.url.exec(t.url);if(1!==n.length){n.shift();var r=0,o=n.length,s=e.urlParams.length,a=Math.min(o,s),i={};for(r;a>r;r++){var u=e.urlParams[r];i[u]=n[r]}t.urlParams=i}}}function j(e){var t,n,r,o=[],s=e instanceof RegExp?function(t){return e.test(t)}:function(t){return e===t};for(t=0,n=k.length;n>t;t++)r=k[t],s(r.url)?O.log(r,["Clearing mock: "+(r&&r.url),r]):o.push(r);return o}var v=e.ajax,k=[],b=[],S=[],C=/=\?(&|$)/,M=(new Date).getTime(),w=500;e.extend({ajax:h});var O={_log:function(t,n,r){var o=e.mockjaxSettings.logging;return t&&"undefined"!=typeof t.logging&&(o=t.logging),r=0===r?r:r||L.LOG,n=n.splice?n:[n],o===!1||r>o?void 0:e.mockjaxSettings.log?e.mockjaxSettings.log(t,n[1]||n[0]):e.mockjaxSettings.logger&&e.mockjaxSettings.logger[e.mockjaxSettings.logLevelMethods[r]]?e.mockjaxSettings.logger[e.mockjaxSettings.logLevelMethods[r]].apply(e.mockjaxSettings.logger,n):void 0},debug:function(e,t){return O._log(e,t,L.DEBUG)},log:function(e,t){return O._log(e,t,L.LOG)},info:function(e,t){return O._log(e,t,L.INFO)},warn:function(e,t){return O._log(e,t,L.WARN)},error:function(e,t){return O._log(e,t,L.ERROR)}},L={DEBUG:4,LOG:3,INFO:2,WARN:1,ERROR:0};return e.mockjaxSettings={log:null,logger:t.console,logging:2,logLevelMethods:["error","warn","info","log","debug"],namespace:null,status:200,statusText:"OK",responseTime:w,isTimeout:!1,throwUnmocked:!1,retainAjaxCalls:!0,contentType:"text/plain",response:"",responseText:"",responseXML:"",proxy:"",proxyType:"GET",lastModified:null,etag:"",headers:{etag:"IJF@H#@923uf8023hFO@I#H#","content-type":"text/plain"}},e.mockjax=function(t){if(e.isArray(t))return e.map(t,function(t){return e.mockjax(t)});var n=k.length;return k[n]=t,O.log(t,["Created new mock handler",t]),n},e.mockjax._logger=O,e.mockjax.clear=function(e){"string"==typeof e||e instanceof RegExp?k=j(e):e||0===e?(O.log(k[e],["Clearing mock: "+(k[e]&&k[e].url),k[e]]),k[e]=null):(O.log(null,"Clearing all mocks"),k=[]),b=[],S=[]},e.mockjax.clearRetainedAjaxCalls=function(){b=[],S=[],O.debug(null,"Cleared retained ajax calls")},e.mockjax.handler=function(e){return 1===arguments.length?k[e]:void 0},e.mockjax.mockedAjaxCalls=function(){return b},e.mockjax.unfiredHandlers=function(){for(var e=[],t=0,n=k.length;n>t;t++){var r=k[t];null===r||r.fired||e.push(r)}return e},e.mockjax.unmockedAjaxCalls=function(){return S},e.mockjax});