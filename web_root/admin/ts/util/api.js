define("ts/util/api.ts",function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=t("ts/app.cfg.ts"),n=t("ts/util/utils.ts");r.default.apiServer||r.default.onUnauthorizedError();var i=r.default.onServerError||function(t){alert("err: "+t)},o={dom:$("#opgAjaxLoading"),handlers:0,timer:0,show:function(){o.dom.stop(!0,!0).fadeIn()},hide:function(){o.handlers||o.dom.stop(!0,!0).fadeOut()}},s=function(){function t(t,e,n,i){void 0===n&&(n="GET"),void 0===i&&(i=!0),this.name=e,this.method=n,this.restful=i,this.timeOut=r.default.ajaxTimeOut,this.url=0===t.indexOf("http://")||0===t.indexOf("https://")?t:r.default.apiServer+t.replace(/^\//,""),this.unlimited=!1,this.accessible=!0}return t.prototype.handleError=function(t,e){return"function"==typeof this.onError?this.onError.call(this,t,e):i.call(this,t,e)},t.prototype.invoke=function(t,e){var r=this;if(this.accessible||this.unlimited){this.accessible=!1,$.isFunction(t)&&(e=t,t=null);var i=this.url,s=this.method,a="application/json",u=!0;return"UPLOAD"===s?(a=!1,u=!1,s="POST"):t&&(this.restful||"GET"==this.method?this.restful&&(i=n.format.json(i,t),t=null):t=JSON.stringify(t)),$.ajax({contentType:a,processData:u,dataType:"json",url:i,data:t,method:s,cache:!1,timeout:r.timeOut,beforeSend:function(){o.handlers++,o.timer&&clearTimeout(o.timer),o.timer=0,o.show()},complete:function(){return o.handlers--,o.timer=setTimeout(o.hide,100),r.accessible=!0,r=null,t},error:function(t,n,i){if(t.responseJSON&&t.responseJSON.meta&&t.responseJSON.meta.message)r.handleError.call(r,t.responseJSON.meta.message,e);else{var o=t.status;"timeout"===i?i="连接超时":i?"Not Found"===i&&(i="无此接口"):i="无法连接服务器",r.handleError.call(r,"api."+r.name+" error "+o+" ("+i+")")}},success:function(t,n,i){t.error?r.handleError.call(r,t.error,e):e&&"function"==typeof e&&e(t,n,i)}})}throw new Error("Server function ["+this.name+"] unusable now.")},t}(),a=function(t){for(var e in t){var r=e.split("!"),n=r[0],i=r[1]?r[1].toString().toUpperCase():"GET",o=!(void 0===r[2])||t[e].indexOf("${")>-1;a[n]||(a[n]=function(t){var e=function(e,r){return t.invoke.call(t,e,r)};return e.set=function(r,n){return t[r]=n,e},e.get=function(e){return t[e]},e.toString=function(){return t.url},e}(new s(t[e],n,i,o)))}return a};e.api=a});