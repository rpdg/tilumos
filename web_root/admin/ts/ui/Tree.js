define("ts/ui/Tree.ts",function(e,t){"use strict";function a(e,t){for(var i,l=0,s=e.length;s>l;l++){var r=e[l];if(r.id==t){i=r;break}if(r.children&&(i=a(r.children,t)))break}return i}var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var l=e("ts/ui/DisplayOject.ts"),s=e("ts/ui/Combo.ts"),r=e("ts/util/store.ts"),n=function(e){function t(t,a){var i=this;return a=$.extend({text:"name",value:"id",cache:!0},a),i=e.call(this,t,a)||this}return i(t,e),t.prototype.init=function(t,a){var i=this;e.prototype.init.call(this,t,a),this.cache=a.cache,this.treeName=a.name,this._store=new r.LocalStore(!1),this._cachedExpandedLeaf={},this.treeName||(this.treeName=""+this.guid,this.cache&&(this.cache=!1)),this.treeName="tree_"+this.treeName,this.cache&&(this._cachedExpandedLeaf=this._store.get(this.treeName)||{}),a.template||(a.template="checkAll"===a.cmd?'<label><input id="'+this.treeName+'Chk_${id}" type="checkbox" value="${'+a.value+'}"> ${'+a.text+"}</label>":"${"+a.text+"}");var l=this;if(this.cmd=a.cmd,a.root){this.root=$("<ul></ul>");var n=$('<ul class="filetree treeview rootUl"><li class="last rootLi">\n							<span class="folder rootSp">'+a.root+"</span>\n						</li></ul>");n.find("li").append(this.root),n.appendTo(this.jq)}else this.root=$('<ul class="filetree treeview"></ul>'),this.jq.append(this.root);if(this.selectedItemId=-1,this.currentLi=null,this.render=a.render,this.template='<li id="'+this.treeName+'Li_${id}" class="${id:=_getLiClass}" data-id="${id}">${id:=_getDiv}<span id="'+this.treeName+'Sp_${id}" data-id="${id}" class="sp ${id:=_getSpClass}">'+a.template+"</span>${id:=_getUl}</li>",this.root.on("click",".hitarea",function(e){e.stopImmediatePropagation();var t=$(this);t.toggleClass("collapsable-hitarea expandable-hitarea").siblings("ul").toggle();var a=t.parent(),i=a.data("id");a.toggleClass("collapsable expandable"),l.cache&&(i in l._cachedExpandedLeaf?delete l._cachedExpandedLeaf[i]:l._cachedExpandedLeaf[i]=1,l._store.set(l.treeName,l._cachedExpandedLeaf)),this.className.indexOf("last")>-1&&(t.toggleClass("lastCollapsable-hitarea lastExpandable-hitarea"),a.toggleClass("lastExpandable lastCollapsable"))}),this.jq.on("click",".sp",function(e){var t=$(this);l.selectedItemId!=t.data("id")&&(l.prevItemId=l.selectedItemId,l.prevLi=l.currentLi,l.selectedItemId=t.data("id"),l.currentLi=t.closest("li"),l.prevLi&&l.prevLi.find(".sp").removeClass("selected"),t.addClass("selected"),"function"==typeof l.onSelect&&l.onSelect(e))}),a.combo){var c=$(a.combo.textField);c.after(this.jq),this.combo=new s.Combo(c,{allowBlank:a.combo.allowBlank,target:this.jq.addClass("treeField-combo"),valueField:a.combo.valueField}),this.textSrc=a.text,this.valueSrc=a.value,this.jq.on("click",".sp",function(){i.syncData(i.getSelectedData())}),a.combo.closeOnClick&&this.jq.on("click",function(){return i.combo.close()})}},t.prototype.getSelectedData=function(){return a(this.data,this.selectedItemId)},t.prototype.bindData=function(e){var t,a=e;t=$.isArray(e)?e:e[this.arrSrc],this.add(t),this.prevItemId=this.selectedItemId,this.selectedItemId=-1,this.prevLi=this.currentLi,this.currentLi=null,this.data=t,this.bindHandler(a)},t.prototype.add=function(e,t){var a,i=this;a=t?$("#"+i.treeName+"Ul_"+t.id):this.root;var l={_getDiv:function(t,a,l){if(l.children||l.hasChildren){var s=void 0;return t in i._cachedExpandedLeaf?(s="hitarea collapsable-hitarea",a+1===e.length&&(s+=" lastCollapsable-hitarea")):(s="hitarea expandable-hitarea",a+1===e.length&&(s+=" lastExpandable-hitarea")),'<div class="'+s+'"></div>'}return""},_getUl:function(e,t,a){if(a.children||a.hasChildren){var l=e in i._cachedExpandedLeaf?"":' style="display: none;"';return'<ul id="'+i.treeName+("Ul_"+e+'" '+l+"></ul>")}return""},_getLiClass:function(t,a,l){var s="";return l.children||l.hasChildren?t in i._cachedExpandedLeaf?(s="collapsable",a+1===e.length&&(s+=" lastCollapsable")):(s="expandable",a+1===e.length&&(s+=" lastExpandable")):a+1===e.length&&(s="last"),s},_getSpClass:function(e,t,a){return a.children||a.hasChildren?"folder":"file"}};if(i.render)for(var s in i.render)s in l||(l[s]=i.render[s]);a.bindList({list:e,template:i.template,itemRender:l,mode:t?"append":"html"});for(var r=0,n=e.length;n>r;r++){var c=e[r];c.children&&this.add(c.children,c)}"checkAll"===this.cmd&&a.find(".folder").each(function(e,t){var a=$(t),i=a.siblings("ul");a.find(":checkbox").checkBoxAll(":checkbox",i)})},t.prototype.findObjectById=function(e){return a(this.data,e)},t.prototype.syncData=function(e){this.combo.setValue(e[this.textSrc],e[this.valueSrc])},t}(l.AjaxDisplayObject);t.default=n});