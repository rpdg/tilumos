define("ts/ui/Table.ts",function(t,e){"use strict";function i(t){for(var e,i,n=[],a=0,s=(t.columns?t.columns.length:0,void 0);s=t.columns[a];a++)if("function"==typeof s.render?(i=s.src+"_render"+o.DisplayObject.guid(),e=":="+i,t.bindOptions.itemRender[i]=s.render):e="",s.cmd)n[a]="checkAll"===s.cmd?'<td class="text-center"><input type="checkbox" name="chk_'+a+'" value="${'+s.src+e+'}"></td>':'<td class="text-center"><input type="radio" name="chk_'+a+'" value="${'+s.src+e+'}"></td>',this.cmd||(this.cmd=s.cmd,this.cmdColumnIndex=a);else{var r="text-"+(s.align?s.align.toLowerCase():"center");n[a]='<td class="'+r+'">${'+s.src+e+"}</td>"}var h;return t.rows&&t.rows.render?(h=t.rows.src||"___",t.bindOptions.itemRender.__renderTr=function(e,i,n,a){var s=t.rows.render(e,i,n,a)||"",o=i%2?"odd":"even";return o+" "+s}):(h="___",t.bindOptions.itemRender.__renderTr=function(t,e){return e%2?"odd":"even"}),'<tr class="${'+h+':=__renderTr}">'+n.join("")+"</tr>"}function n(t,e){for(var i=0,n=e.columns?e.columns.length:0,a=[],s=[],o=void 0;o=e.columns[i];i++)o.cmd&&(o.width=o.width||32,o.text="checkAll"===o.cmd?'<input type="checkbox" name="'+o.src+'" value="chk_'+i+'">':'<input type="hidden" name="'+o.src+'" value="chk_'+i+'">'),a[i]="width:"+(o.width?o.width+"px;":"auto; "),s[i]='<th style="'+a[i]+'">'+(o.text||"column_"+i)+"</th>";var r="<thead><tr>"+s.join("")+"</tr></thead>",h=e.pagination?'<tfoot><tr><td colspan="'+(n||"1")+'"></td></tr></tfoot>':"";t.prepend(r+'<tbody id="'+t[0].id+'_tbody"></tbody>'+h)}function a(t,e){var i='<div class="grid-title-bar">\n		'+e.title+"\n	</div>",n=$(i),a="";if(e.buttons&&e.buttons.length){for(var s=0,o=e.buttons.length;o>s;s++){var r=e.buttons[s];a+='<button id="'+r.id+'" class="'+r.className+'">'+r.html+"</button>"}n.append(a)}t.before(n)}var s=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=t("ts/ui/DisplayOject.ts"),r=t("ts/util/utils.ts"),h=function(t){function e(e,i){var n=this;return i=$.extend({bindOptions:{itemRender:{}},resizable:!0},i),n=t.call(this,e,i)||this}return s(e,t),e.prototype.init=function(e,s){var o=this;t.prototype.init.call(this,e,s);var r="TABLE"===e[0].tagName;if(r?(e.addClass("grid"),this.table=e):this.table=$('<table id="'+e[0].id+'_table" class="grid"></table>'),this.resizable=s.resizable,this._bindOption.template=i.call(this,s),n(this.table,s),s.titleBar&&a(this.table,s.titleBar),r||e.append(this.table),this.thead=this.table.find("thead"),this.cols=s.columns.length,this.tbody=this.table.find("tbody"),this.container=this.tbody,this.tbody.on("click","tr",function(t){o.selectHandler(t)}),this.resizable&&this.table.resizableColumns({minWidth:1}),s.pagination){var h=this,p={append_number_input:!0,link_to:"javascript:void(0)",num_edge_entries:1,num_display_entries:5,items_per_page:10,prev_text:"上页",next_text:"下页",load_first_page:!1,callback:function(t){return h._param.pageIndex=t,h.update(o._param),!1},pageSize:10,showCount:!0,customizable:!0};s.pagination.pageSize&&(s.pagination.items_per_page=s.pagination.pageSize),s.pagination=$.extend(p,s.pagination),this.pagination=s.pagination,this._param=$.extend({pageIndex:0,pageSize:s.pagination.pageSize},s._params)}},e.prototype.createdHandler=function(t){"checkAll"===this.cmd?(this.cmdCheckAll=this.thead.find("th:eq("+this.cmdColumnIndex+")").find("input"),this.cmdCheckAll.syncCheckBoxGroup("td:eq("+this.cmdColumnIndex+")>:checkbox:enabled",this.tbody.find("tr"))):"checkOne"===this.cmd&&(this.cmdCheckOne=this.thead.find("th:eq("+this.cmdColumnIndex+")").find("input:hidden")),this._created=!0,this._createdPromise&&this._createdPromise.resolve(),this.onCreate&&this.onCreate(t)},e.prototype.bindHandler=function(t){this.pagination&&this.makePager(~~t.page.rowCount),"function"==typeof this.onBind&&this.onBind(t)},e.prototype.updateHandler=function(t){return this.cmdCheckAll&&(this.cmdCheckAll.prop("checked",!1),this.cmdCheckAll.syncCheckBoxGroup("td:eq("+this.cmdColumnIndex+")>:checkbox:enabled",this.tbody.find("tr"))),$.isFunction(this.onUpdate)&&this.onUpdate(t),this},e.prototype.makePager=function(t){var e=this,i=this,n=Math.ceil(t/this._param.pageSize);if(0===n&&(n=1),this._param.pageIndex>0&&n<this.pageCount)return this._param.pageIndex-=this.pageCount-n,setTimeout(function(){return e.update()},10);this.pageCount=n;var a=this._param.pageIndex;if(this.tPager)this.pagination.current_page=this._param.pageIndex,this.tPager.pagination(t,this.pagination),this.pagination.showCount&&(this.pageCounter.find(".bt").text(t),this.pageCounter.find(".bc").text(n));else{if(this.tfoot=this.table.find("tfoot td:eq(0)"),this.tPager=$('<div class="pagination_container"></div>').appendTo(this.tfoot),this.tPager.pagination(t,this.pagination),this.iptPageGo=this.tfoot.find(".iptPageGo"),this.pagination.append_number_input=this.iptPageGo,this.pageCounter=$("<span></span>"),this.tPager.after(this.pageCounter),this.pagination.showCount){this.pageTemplate="string"==typeof this.pagination.showCount?this.pagination.showCount:'共<span class="bt">${rowCount}</span>条记录 , 第<span class="bf">${pageNum}</span> / <span class="bc">${pageCount}</span>页',this.pageCounter.html(r.format.json(this.pageTemplate,{rowCount:t,pageIndex:a,pageCount:n}));var s=this.pageCounter.find(".bf");this.iptPageGo.val(a),s.replaceWith(this.iptPageGo)}if(this.pagination.customizable){"object"!=typeof this.pagination.customizable&&(this.pagination.customizable=[10,20,50]);for(var o=this.pagination.customizable,h=[],p=0,d=o.length;d>p;p++)h[p]='<option value="'+o[p]+'" '+(o[p]==this.pagination.pageSize?"selected":"")+">"+o[p]+"</option>";var c=$("<select>"+h.join("")+"</select>");this.pageCounter.after($('<label class="pageSelectorLabel">每页</label>').append(c).append("条")),c.on("change.opg",function(){return i.pagination.items_per_page=i._param.pageSize=~~this.options[this.selectedIndex].value,i._param.pageIndex=0,i.update(i._param),!1})}}},e.prototype.getCheckData=function(){if(this.cmd){for(var t=(this.cmdCheckAll||this.cmdCheckOne).val(),e=this.tbody.find("input[name='"+t+"']"),i=this.cmdCheckAll?[]:null,n=0,a=e.length;a>n;n++)if(e[n].checked){if(this.cmdCheckOne)return this.data[n];i.push(this.data[n])}return i}return null},e.prototype.getCheckedValue=function(){if(this.cmd){var t,e=(this.cmdCheckAll||this.cmdCheckOne).val(),i=this.tbody.find("input[name='"+e+"']:checked");return this.cmdCheckAll?(t=[],i.each(function(e,i){t.push(i.value)})):t=i.length?i.val():null,t}return null},e}(o.AjaxDisplayObject);e.default=h});